{"ast":null,"code":"import _regeneratorRuntime from\"/Users/admin/Documents/react-projects/hesmis/hesmis-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/admin/Documents/react-projects/hesmis/hesmis-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import axios from'axios';import{isEmpty}from'lodash';import{get}from'react-hook-form';import{authActions,serverActions}from'../actions';import{getAccessToken,clearToken}from'./storageService';var path=new RegExp(\"/login$\");var httpService={setupInterceptors:function setupInterceptors(store){var dispatch=store.dispatch;axios.interceptors.request.use(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(config){var token,localConfig;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getAccessToken();case 2:token=_context.sent;localConfig=config;if(!localConfig.thirdParty){if(token){if(!localConfig.headers){localConfig.headers={};}if(token&&!path.test(config.url)){localConfig.headers.Authorization=\"Bearer \".concat(token);}}if(!localConfig.headers['Content-type']){localConfig.headers['Content-type']='application/json';}localConfig.headers.Accept='application/json';localConfig.timeout=60000;localConfig.baseURL=process.env.REACT_APP_API_BASE_URL||'http://localhost:3123';}dispatch(serverActions.serverRequest());return _context.abrupt(\"return\",localConfig);case 7:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}(),function(error){return Promise.reject(error);});axios.interceptors.response.use(function(response){var data=get(response,'data',{});var config=get(response,'config',{});if(config&&config.method!=='get'&&!config.hideMessage){if(data){dispatch(serverActions.serverSuccess(data));}}// Return entire response if response type blob\nif(config&&config.responseType==='blob')return response;return data;},function(error){var codeError=get(error,'code','');var errorResponse=get(error,'response',{});if(!isEmpty(errorResponse)){if(errorResponse.status===401){clearToken();dispatch(authActions.setIsAuthenticated(false));dispatch(authActions.setAuthUser(null));errorResponse={data:{server:{message:'Session Expired!'}}};}else if(errorResponse.status===404){var _errorResponse$data;errorResponse={data:{server:{message:((_errorResponse$data=errorResponse.data)===null||_errorResponse$data===void 0?void 0:_errorResponse$data.message)||errorResponse.statusText}}};}}else if(codeError==='ECONNABORTED'){errorResponse={data:{server:{message:'Sorry... Connection time out, Please try again!'}}};}else{errorResponse={data:{server:{message:'Connection Failed, Please check your Internet connection and try again.'}}};}dispatch(serverActions.serverError(errorResponse));return Promise.reject(errorResponse);});}};export default httpService;","map":{"version":3,"sources":["/Users/admin/Documents/react-projects/hesmis/hesmis-front/src/config/services/httpService.js"],"names":["axios","isEmpty","get","authActions","serverActions","getAccessToken","clearToken","path","RegExp","httpService","setupInterceptors","store","dispatch","interceptors","request","use","config","token","localConfig","thirdParty","headers","test","url","Authorization","Accept","timeout","baseURL","process","env","REACT_APP_API_BASE_URL","serverRequest","error","Promise","reject","response","data","method","hideMessage","serverSuccess","responseType","codeError","errorResponse","status","setIsAuthenticated","setAuthUser","server","message","statusText","serverError"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport { isEmpty } from 'lodash';\nimport { get } from 'react-hook-form';\nimport { authActions, serverActions } from '../actions';\nimport { getAccessToken, clearToken } from './storageService';\n\nconst path = new RegExp(`/login$`);\n\nconst httpService = {\n  setupInterceptors: (store) => {\n    const { dispatch } = store;\n\n    axios.interceptors.request.use(\n      async (config) => {\n        const token = await getAccessToken();\n        const localConfig = config;\n        if (!localConfig.thirdParty) {\n          if (token) {\n            if (!localConfig.headers) {\n              localConfig.headers = {};\n            }\n            if (token && !path.test(config.url)) {\n              localConfig.headers.Authorization = `Bearer ${token}`;\n            }\n          }\n          if (!localConfig.headers['Content-type']) {\n            localConfig.headers['Content-type'] = 'application/json';\n          }\n          localConfig.headers.Accept = 'application/json';\n          localConfig.timeout = 60000;\n          localConfig.baseURL = process.env.REACT_APP_API_BASE_URL || 'http://localhost:3123';\n        }\n        dispatch(serverActions.serverRequest());\n        return localConfig;\n      },\n      (error) => Promise.reject(error)\n    );\n\n    axios.interceptors.response.use(\n      (response) => {\n        const data = get(response, 'data', {});\n        const config = get(response, 'config', {});\n        if (config && config.method !== 'get' && !config.hideMessage) {\n          if (data) {\n            dispatch(serverActions.serverSuccess(data));\n          }\n        }\n        // Return entire response if response type blob\n        if (config && config.responseType === 'blob') return response;\n        return data;\n      },\n      (error) => {\n        const codeError = get(error, 'code', '');\n        let errorResponse = get(error, 'response', {});\n\n        if (!isEmpty(errorResponse)) {\n          if (errorResponse.status === 401) {\n            clearToken();\n            dispatch(authActions.setIsAuthenticated(false));\n            dispatch(authActions.setAuthUser(null));\n            errorResponse = {\n              data: { server: { message: 'Session Expired!' } },\n            };\n          } else if (errorResponse.status === 404) {\n            errorResponse = {\n              data: {\n                server: {\n                  message:\n                    errorResponse.data?.message || errorResponse.statusText,\n                },\n              },\n            };\n          }\n        } else if (codeError === 'ECONNABORTED') {\n          errorResponse = {\n            data: {\n              server: {\n                message: 'Sorry... Connection time out, Please try again!',\n              },\n            },\n          };\n        } else {\n          errorResponse = {\n            data: {\n              server: {\n                message:\n                  'Connection Failed, Please check your Internet connection and try again.',\n              },\n            },\n          };\n        }\n        dispatch(serverActions.serverError(errorResponse));\n        return Promise.reject(errorResponse);\n      }\n    );\n  },\n};\n\nexport default httpService;\n"]},"metadata":{},"sourceType":"module"}