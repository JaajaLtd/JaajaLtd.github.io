{"ast":null,"code":"import _slicedToArray from\"/Users/admin/Documents/react-projects/hesmis/hesmis-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{isEmpty}from'lodash';import React,{useEffect,useState}from'react';import{Button}from'react-bootstrap';import{useCookies}from'react-cookie';import{useDispatch,useSelector}from'react-redux';import{AlertMessage}from'../../components/common';import{authActions}from'../../config/actions';import RoutePaths from'../../config/routes/RoutePaths';import{removeEmptyOrNullObject}from'../../helpers/dataFormatter';import usePrevious from'../Hooks/usePrevious';import LoginForm from'./LoginForm';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Login=function Login(_ref){var setCurrentPage=_ref.setCurrentPage;var dispatch=useDispatch();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useCookies=useCookies(),_useCookies2=_slicedToArray(_useCookies,2),cookies=_useCookies2[0],setCookie=_useCookies2[1];var _useSelector=useSelector(function(state){return state.auth;}),loginError=_useSelector.loginError,loginData=_useSelector.loginData,isAuthenticated=_useSelector.isAuthenticated;var previousState=usePrevious({loginError:loginError,loginData:loginData});var accessToken=cookies.auth_access;useEffect(function(){if(!isEmpty(accessToken===null||accessToken===void 0?void 0:accessToken.token)&&isAuthenticated===true){dispatch(authActions.setIsAuthenticated(true));}},[]);useEffect(function(){if(!isEmpty(previousState)&&!isEmpty(loginData)&&previousState.loginData!==loginData){var _loginData$server;if(((_loginData$server=loginData.server)===null||_loginData$server===void 0?void 0:_loginData$server.status)===true){setCookie('auth_access',loginData.access_token,{path:'/',sameSite:true});dispatch(authActions.setIsAuthenticated(true));}}},[loginData]);useEffect(function(){if(!isEmpty(previousState)&&!isEmpty(loginError)&&previousState.loginError!==loginError){var _loginError$error;var message=((_loginError$error=loginError.error)===null||_loginError$error===void 0?void 0:_loginError$error.message)||loginError.error||loginError.server.message;setError(message);if(message==='Please change your default password before login in.'){setTimeout(function(){setCurrentPage(RoutePaths.resetPassword.path);},2000);}}},[loginError]);var onSubmit=function onSubmit(data){setError(null);if(!isEmpty(data)){dispatch(authActions.loginStudent(removeEmptyOrNullObject(data)));}};return/*#__PURE__*/_jsxs(_Fragment,{children:[!isEmpty(error)&&/*#__PURE__*/_jsx(AlertMessage,{message:error,className:\"p-1 px-3 text-sm rounded-sm\"}),/*#__PURE__*/_jsx(LoginForm,{onSubmit:onSubmit}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-3 mb-2 text-center text-sm font600\",children:/*#__PURE__*/_jsx(Button,{variant:\"link\",className:\"text-sm\",onClick:function onClick(){return setCurrentPage(RoutePaths.resetPassword.path);},children:\"Reset My Password\"})})]});};export default Login;","map":{"version":3,"sources":["/Users/admin/Documents/react-projects/hesmis/hesmis-front/src/containers/Auth/Login.jsx"],"names":["isEmpty","React","useEffect","useState","Button","useCookies","useDispatch","useSelector","AlertMessage","authActions","RoutePaths","removeEmptyOrNullObject","usePrevious","LoginForm","Login","setCurrentPage","dispatch","error","setError","cookies","setCookie","state","auth","loginError","loginData","isAuthenticated","previousState","accessToken","auth_access","token","setIsAuthenticated","server","status","access_token","path","sameSite","message","setTimeout","resetPassword","onSubmit","data","loginStudent"],"mappings":"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","sourcesContent":["import { isEmpty } from 'lodash';\nimport PropTypes from 'prop-types';\nimport React, { useEffect, useState } from 'react';\nimport { Button } from 'react-bootstrap';\nimport { useCookies } from 'react-cookie';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { AlertMessage } from '../../components/common';\nimport { authActions } from '../../config/actions';\nimport RoutePaths from '../../config/routes/RoutePaths';\nimport { removeEmptyOrNullObject } from '../../helpers/dataFormatter';\nimport usePrevious from '../Hooks/usePrevious';\nimport LoginForm from './LoginForm';\n\nconst Login = ({ setCurrentPage }) => {\n  const dispatch = useDispatch();\n  const [error, setError] = useState(null);\n  const [cookies, setCookie] = useCookies();\n  const { loginError, loginData, isAuthenticated } = useSelector(\n    (state) => state.auth\n  );\n  const previousState = usePrevious({ loginError, loginData });\n  const accessToken = cookies.auth_access;\n\n  useEffect(() => {\n    if (!isEmpty(accessToken?.token) && isAuthenticated === true) {\n      dispatch(authActions.setIsAuthenticated(true));\n    }\n  }, []);\n\n  useEffect(() => {\n    if (\n      !isEmpty(previousState) &&\n      !isEmpty(loginData) &&\n      previousState.loginData !== loginData\n    ) {\n      if (loginData.server?.status === true) {\n        setCookie('auth_access', loginData.access_token, {\n          path: '/',\n          sameSite: true,\n        });\n        dispatch(authActions.setIsAuthenticated(true));\n      }\n    }\n  }, [loginData]);\n\n  useEffect(() => {\n    if (\n      !isEmpty(previousState) &&\n      !isEmpty(loginError) &&\n      previousState.loginError !== loginError\n    ) {\n      const message =\n        loginError.error?.message ||\n        loginError.error ||\n        loginError.server.message;\n      setError(message);\n\n      if (message === 'Please change your default password before login in.') {\n        setTimeout(() => {\n          setCurrentPage(RoutePaths.resetPassword.path);\n        }, 2000);\n      }\n    }\n  }, [loginError]);\n\n  const onSubmit = (data) => {\n    setError(null);\n    if (!isEmpty(data)) {\n      dispatch(authActions.loginStudent(removeEmptyOrNullObject(data)));\n    }\n  };\n\n  return (\n    <>\n      {!isEmpty(error) && (\n        <AlertMessage message={error} className=\"p-1 px-3 text-sm rounded-sm\" />\n      )}\n      <LoginForm onSubmit={onSubmit} />\n      <div className=\"mt-3 mb-2 text-center text-sm font600\">\n        <Button\n          variant=\"link\"\n          className=\"text-sm\"\n          onClick={() => setCurrentPage(RoutePaths.resetPassword.path)}\n        >\n          Reset My Password\n        </Button>\n      </div>\n    </>\n  );\n};\n\nLogin.propTypes = {\n  setCurrentPage: PropTypes.func.isRequired,\n};\n\nexport default Login;\n"]},"metadata":{},"sourceType":"module"}